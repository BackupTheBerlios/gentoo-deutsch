<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<!-- Englich CVS Version 1.10 -->

<guide link="doc/de/alsa-guide.xml">
<title>Gentoo Linux ALSA Anleitung</title>
<author title="Author"><mail link="zu@pandora.be">
	Vincent Verleye</mail>
</author>
<author title="Author"><mail link="g2boojum@gentoo.org">
	Grant Goodyear</mail>
</author>
<author title="Author"><mail link="agenkin@gentoo.org">
	Arcady Genkin</mail>
</author>
<author title="Editor"><mail link="zhen@gentoo.org">
	John P. Davis</mail>
</author>
<author title="Übersetzer"><mail link="js@ameds.de">
	Jens Schittenhelm</mail>
</author>
<author title="Übersetzer"><mail link="dertobi123@gentoo.org">
	Tobias Scherbaum</mail>
</author>	
<abstract>
Dieses Dokument zeigt, wie unter Gentoo Linux das Advanced Linux Sound Architecture (ALSA) installiert 
und eingerichtet werden kann. Dieses Dokument soll zusätzliche Informationen zur Gentoo Linux Desktop 
Konfiguration vermitteln.
</abstract>

<version>1.2</version>
<date>5 Jun 2003</date>

<chapter>
<title>Installation</title>
<section>
	<title>Kernel Module</title>
<body>
<p>
Da wir zur Zeit noch die 2.4.x Kernel Serie benutzen, müssen die Kernel und ALSA Module 
separat kompiliert werden. Wenn Sie bereits einen 2.6.x benutzen, können dies in der
Kernel Configuration einstellen, da die ALSA Module ab 2.5 in den Kernel Sourcen enthalten
sind.
</p>
<p>
Zuerst müssen wir sicherstellen, dass unsere Kernel Konfiguration für den Einsatz von ALSA vorbereitet ist. Dazu ist es
notwendig, dass im Kernel der Punkt "Sound Card Support" als Modul (M) einkompiliert wird. Dadurch wird das Modul <c>soundcore.o</c>
erstellt.
</p>
<p>
<note>
Wahrscheinlich wird es auch funktionieren, wenn "Sound Card Support" direkt in den Kernel (Y) einkompiliert, anstatt es
als Modul (M) zu bauen. Jedoch empfiehlt die offizielle ALSA Dokumentation es als Modul (M) zu erstellen, da ALSA
beim Start versucht, das Modul zu laden.
</note>
</p>
<p>Wenn Sie bereits eine funktionsfähige Kernel Konfiguration besitzen, sollten Sie sicherstellen, dass alle anderen Soundkarten
Treiber entfernt wurden, mit Ausnahme des bereits erwähnten "Sound Card Support". Um nicht neu booten zu müssen, empfiehlt
sich folgendes Vorgehen:
</p>
<pre>
# <c>cd /usr/src/linux</c>
# <c>cp .config ~/</c>
# <c>make mrproper</c>
# <c>cp ~/.config .</c>
# <c>make menuconfig</c>
</pre>
<p>
Nun sollte <e>Sound Card Support</e> als Modul (M) ausgewählt werden und alle anderen Soundkarten Treiber abgewählt werden.
Nun menuconfig beenden und mit Y die Kernel Konfiguration abspeichern.
Danach bauen wir die Module mit:
</p>
<pre>
# <c>make dep clean</c>
# <c>make modules modules_install</c>
</pre>
<p>
Die letzte Zeile stellt sicher, dass vor der Installation neuer Module die alten überschrieben werden, auch die einer
älteren ALSA Installation.
</p>
<p>
<impo>
Das bedeutet, dass JEDES MAL wenn der Kernel neu kompiliert wird, <c>alsa-driver</c> ebenfalls neu
kompiliert werden muss!
</impo>
</p>
<p>
<note>Jedoch ist es nicht notwendig <c>nvidia-kernel</c> neu zu installieren, da die Nvidia Treiber in einem
separatem Verzeichnis abgelegt werden (konkret: <path>/lib/modules/*/video</path>) und somit von dem
Befehl <c>make modules modules_install</c> nicht tangiert werden.
</note>
</p>
</body>
</section>

<section>
	<title>Das richtige ALSA Modul</title>
<body>

<p>
Nun wird es Zeit, die passenden ALSA Treiber für Ihre Soundkarte zu installieren. Wenn Ihre Soundkarte auf einem
PCI Steckplatz sitzt, kann der output von /proc/pci den Namen und Typ der Karte offenbaren:
<pre>#<c>cat /proc/pci  | grep audio</c></pre>
</p>

<p>
<warn>
Sollten Sie zuvor ein anderes Audio System eingerichtet haben und Nicht-ALSA Module sich noch im Speicher befinden,
empfiehlt es sich, diese <e>jetzt</e> zu entfernen. Überprüfen Sie mit <c>lsmod</c> Ihre geladenen Module und entfernen 
Sie mit <c>rmmod</c> nicht mehr benötigte Treiber auf Ihrem System.
</warn>
</p>

<p>
Ein einfaches <c>emerge alsa-driver</c> würde <e>alle</e> ALSA Treiber kompilieren und in das System einbinden.
</p>
<p>
Um jedoch Zeit zu sparen, empfiehlt es sich, den <e>Modul Namen</e> Ihrer Soundkarte in der 
<uri link="http://www.alsa-project.org/alsa-doc">ALSA Soundcard Matrix</uri> im Abschnitt  <e>Install</e>
nachzuschlagen. Bei mir handelt es sich um das Modul <c>EMU10K1</c>, da ich eine SBlive! Soundkarte
besitze. Dann setzen wir ALSA_CARDS environment Variablen, bevor wir emerge ausführen, sodass emerge
nur die Treiber, die wir wirklich brauchen auch kompilieren wird. Bei mir sieht das folgendermassen aus:
</p>
<p>
<pre>
# <c>env ALSA_CARDS='emu10k1' emerge alsa-driver</c> 
</pre>
</p>
<p>
<note>
Sie können diese Variable auch in die <path>/etc/make.conf</path> eintragen, so dass sie die ALSA Module später mit 
<c>emerge alsa-driver</c> übersetzen können.
Beispiel: <c>echo 'ALSA_CARDS="emu10k1"' >> /etc/make.conf</c>
</note>

<note>
Wenn Sie vorhaben, ALSA Treiber für mehr als eine Soundkarte zu installieren, 
können diese durch ein Leerzeichen getrennt an ALSA_CARDS übergeben werden, 
z.B. so:  <c>env ALSA_CARDS='emu10k1 intel8x0 ens1370' emerge alsa-driver</c>
</note>

<note>Sollten Sie OSS Kompatibilität benötigen, so sollte "emerge <i>alsa-oss</i>" ausgeführt werden, um den ALSA/OSS
compatibility wrapper auf Ihrem System einzurichten. 
</note>

<note>
Die Angabe der ALSA-Matrix stimmt für den in vielen ACER Notebooks verwendeten M4145-chip nicht. Das gesuchte Modul heisst "ali5451"
</note>
</p>
<p>
Mit diesen wenigen Handgriffen, sollten die ALSA Module bereits auf Ihrem System installiert sein.
</p>
</body>
</section>
<section>
	<title>Konfiguration von ALSA</title>
<body>
<p>
Als nächstes sollten wir die Konfiguration vornehmen, um ALSA sauber einzurichten. Dazu müssen einige
Konfigurationsdateien geändert werden, damit Ihr System von den neu installierten Modulen auch Kenntniss nimmt.
</p>
<p>
Die erste zu editierende Datei ist <path>/etc/modules.d/alsa</path>.
</p>
<warn>
Es ist nicht notwendig <path>/etc/modules.conf</path> zu modifizieren. Es sollten immer die Dateien in <path>/etc/modules.d</path> bearbeitet werden.
</warn>
<p>
Überprüfen Sie den ALSA Abschnitt am <e>Ende der Konfigurationsdatei</e>. 
Durch Hinzufügen dieser Zeile, können Sie die maximale Nummer der benutzen Soundkarten auf 
Ihrem System angeben (im Normalfall ist dies nur eine einzige).
</p>
<p>
<pre caption="Am Ende von /etc/modules.d/alsa">
<c>options snd cards_limit=1</c>
</pre>
</p>
<p>
Nun geben wir an, welche Treiber ALSA benutzen soll. Im der gleichen Datei tragen wir folgende Zeilen ein:
<pre caption="In /etc/modules.d/alsa">
## and then run `update-modules' command.
## Read alsa-driver's INSTALL file in /usr/share/doc for more info.
##
##  ALSA portion
<c>alias snd-card-0 snd-emu10k1</c>
<c>## If you have more than one, add:
## alias snd-card-1 snd-intel8x0
## alias snd-card-2 snd-ens1370</c>
##  OSS/Free portion
## alias sound-slot-0 snd-card-0
## alias sound-slot-1 snd-card-1
##
</pre>
Natürlich sollten Sie hier darauf achten snd-emu10k1 durch den Namen des richtigen Moduls für Ihre Soundkarte zu ersetzen.
</p>
<p>
<note>
Wenn Sie mehr als eine Soundkarte besitzen, sollte der Wert für <c>cards_limit</c> angepasst werden und entsprechend
für jede Soundkarte ein snd-card alias eingefügt werden. Sollten Sie damit keine Erfahrung haben, so finden Sie in 
<uri link="http://www.alsa-project.org/alsa-doc/alsa-howto/c1660.htm">Kapitel 6</uri>
des <uri link="http://www.alsa-project.org/alsa-doc/alsa-howto/alsa-howto.html">ALSA Howto</uri> weitergehende Informationen.
</note>
</p>
<p>
Als letztes sollten Sie noch sicherstellen, dass folgende Zeilen fast am Ende der Konfigurationsdatei vorhanden und
unkommentiert sind:
<pre caption="Fast am Ende von of /etc/modules.d/alsa">
alias /dev/mixer snd-mixer-oss
alias /dev/dsp snd-pcm-oss
alias /dev/midi snd-seq-oss
</pre>
</p>
<p>
Überprüfen Sie noch einmal alle Ihre Eingaben in der Datei <path>/etc/modules.d/alsa</path> und wenn Sie sicher sind, dass
kein Fehler vorhanden ist, können Sie <c>update-modules</c> ausführen:
<pre>
# <c>update-modules</c>
</pre>
</p>
<note>
Durch das Ausführen von <c>update-modules</c> werden die Daten von <path>/etc/modules.d/alsa</path> in <path>/etc/modules.conf</path> geschrieben.
</note>
<p>
Nun sollten Sie sicherstellen, dass in /etc/devfsd.conf die ALSA geräte korrekt eingetragen und registriert sind.
</p>
<p>
<pre caption="/etc/devfsd.conf">
# ALSA/OSS stuff
# Comment/change these if you want to change the permissions on
# the audio devices
LOOKUP          snd          MODLOAD ACTION snd
LOOKUP          dsp          MODLOAD
LOOKUP          mixer        MODLOAD
LOOKUP          midi         MODLOAD
REGISTER        sound/.*     PERMISSIONS root.audio 660
REGISTER        snd/.*       PERMISSIONS root.audio 660
</pre>
</p>
<p>
<note>
Wie man sehen kann, werden von devfsd.conf die Zugriffe auf /dev/sound auf root.audio beschränkt. Nicht root-user müssen also in der Gruppe audio
sein, um die Soundkarte auch zu hören.
</note>
</p>
</body>
</section>
</chapter>
<chapter>
<title>ALSA starten</title>
<section>
	<title>Alsasound zu einem runlevel hinzufügen</title>
<body>
<p>
Nun sollte man daran gehen, ALSA beim booten auch zu starten. Dies geschieht mit einem:
<pre>
# <c>rc-update add alsasound boot</c>
</pre>
</p>
<p>
<warn>Das alsasound Skript gehört in den "boot" runlevel, und nicht in den "default" runlevel!</warn>
</p>
</body>
</section>
<section>
	<title>Stummschaltung aufheben</title>
<body>
<p>
Da wir Linux User sind und rebooten des Systems uncool ist, starten wir das alsasound Skript von Hand:
</p>
<pre>
# <c>/etc/init.d/alsasound start</c>
</pre>
<p>
ALSA sollte jetzt laufen. Wenn alles ok ist, sollte beim Ausführen von <c>lsmod</c> das ALSA Modul angezeigt werden.
Allerdings bekommen wir noch keinen Ton zu hören, da die Kanäle noch stumm geschaltet sind. Um die Einstellungen zu
ändern, brauchen wir <c>alsa-utils</c>.
</p>
<pre>
# <c>emerge alsa-utils</c>
# <c>amixer</c>
</pre>
<p>
<warn>
Normalerweise sollte es gar nicht dazu kommen, aber <e>wenn</e> Sie eine Fehlermeldung in der Art von 
"amixer: Mixer attach default error: No such file or directory" bekommen, sollten Sie 
<c>snd-mixer-oss</c> und <c>snd-pcm-oss</c> aus dem Speicher werfen und erneut mit insmod laden. Danach
sollte amixer noch einmal aufgerufen werden..
</warn>
</p>
<pre caption="Nur bei Fehlermeldungen durch amixer">
# <c>insmod snd-mixer-oss</c>
# <c>insmod snd-pcm-oss</c>
# <c>amixer</c>
</pre>
<p>
Wenn wir nun so weit gekommen sind, sollten wir die Stummschaltung der  Master und PCM Kanäle aufheben:
</p>
<p>
<pre>
# <c>amixer set Master 100 unmute</c>
# <c>amixer set PCM 100 unmute</c>
# <c>aplay ${KDEDIR}/share/sounds/pop.wav</c> <codenote>(pop.wav Bestandteil des KDE Paketes)</codenote>
</pre>
</p>
Um zu Überprüfen, ob der Ton funktioniert, benutzen wir den Befehl aplay (alsa play). Wenn Sie einen Klang hören, dann arbeitet
Ihre Soundkarte. Herzlichen Glückwunsch! Um die Lautstärke an Ihre Bedürfnisse anzupassen, ist das ncurses-basierte Paket
<c>alsamixer</c> die richtige Wahl.
<p>
Sie sind auch sicher dran interssiert <c>alsa-xmms</c> zu installieren, da es die ALSA Unterstützung für XMMS bereitstellt.
</p>
Wenn Sie Ihr System neu booten, wird das <e>alsasound</e> init Skript ihre Lautstärkeeinstellungen sichern und korrekt wieder
herstellen. 
</body>
</section>
</chapter>
<chapter>
<title>Abschliessende Bemerkungen</title>
<section>
	<title>Nach Kernel Aktualisierungen.</title>
<body>
<p> Wenn Sie Ihren Kernel neu kompilieren oder auf einen aktuelleren Kernel umsteigen, dann müssen Sie die
ALSA Module ebenfalls neu kompilieren.</p>
<p>Auch wenn Sie alle Pakete: <c>alsa-driver</c>, <c>alsa-libs</c> und <c>alsa-utils</c> installiert haben, 
ist es notwendig nur das erste Paket neu zu kompilieren, da es die Module unter
<path>/lib/modules/*/kernel/sound/pci/</path> ablegt. Ein einfaches</p>
<pre caption="Nach jeder Kernel Neuerstellung:">
<c>emerge alsa-driver</c>
</pre>
<p> genügt vollständig</p>
</body>
</section>
<section>
	<title>/etc/modules.autoload</title>
<body>
<p>Um ALSA zu benutzen, muss diese Datei im Normalfall nicht modifiziert werden. 
Mit unserem <c>rc-update add alsasound boot</c>
wird das System die richtigen Module beim Start automatisch laden.</p>
<p>Es ist also nicht notwendig <c>snd-pcm-oss</c> oder <c>snd-mixer-oss</c> in diese Datei einzufügen. 
Für weitere Informationen oder häufige Fragen ist <uri link="http://www.djcj.org/LAU/guide/alsbook/faq1.html">dieses FAQ</uri> der
richtige Anlaufpunkt.</p>
</body>
</section>
<section>
	<title>Noch mehr Links</title>
<body>
<p>
Für weitere Informationen rund um ALSA empfehle ich folgende Links:
</p>
<p>
<ul>
<li><uri link="http://www.gentoo.org/doc/en/desktop.xml">The Gentoo Linux Desktop Configuration Guide</uri></li>
<li><uri link="http://www.alsa-project.org">ALSA Project Homepage</uri></li>
<li><uri link="http://www.alsa-project.org/documentation.php3">ALSA Users Documentation</uri></li>
<li><uri link="http://www.djcj.org">ALSA Howto's and FAQ's</uri></li>
<li><uri link="http://tldp.org/HOWTO/Sound-HOWTO/index.html">Linux Sound HOWTO</uri></li>
<li><uri link="http://linux-sound.org/">Sound and MIDI Software For Linux</uri></li>
</ul>
</p>
</body>
</section>
</chapter>
</guide>
 
